<body>
	<form>
        <input type="date" id="dateForm" value="2020-06-30" />
        <input type="number" id="paramForm" value="2" />
  </form>
  <button type="button" onclick="handleRequest()">Click Me!</button>
  <pre id="response"></pre>
  <p id="p1">111</p>
</body>

<script>

  /*This function finds the value of sku from the input form and makes it accessible by other 
  functions - namely handleRequest()*/

function getDateForm() {
  var dateForm = document.getElementById('dateForm').value;
  return dateForm;
}

function getParamForm() {
  var paramForm = document.getElementById('paramForm').value;
  return paramForm;
}

  /*This is the function that the button calls. It defines sku 
  as a variable based on the value in the text form.
  Then, it passes sku to the function requestItemInfo.*/
function handleRequest() {
  var dateForm = getDateForm();
  var paramForm = getParamForm();
    if (dateForm !== null && paramForm !== null) {
    	var response = requestItemInfo(dateForm, paramForm);
    }
  return response;
}
//takes the response and parses it to a json object, makes the json object accessible to other functions, passes the json object to makepretty
function parseResponse(response) {
  var parsedResponse = JSON.parse(response);
  var newParsedResponse = makePretty(parsedResponse);
  var newIsAvailable = showAvailable(parsedResponse);
  return parsedResponse;
}

//makes the parsed response look good
function makePretty(parsedResponse) {
  var prettyResponse = JSON.stringify(parsedResponse, null, 2);
  document.getElementById('response').textContent=prettyResponse;
}

//supposed to show "availabe" or "unavailable" based on the response, but is currently broken
function showAvailable(parsedResponse) {
  console.log(parsedResponse);
  var isAvailable = parsedResponse.items;
  document.getElementById('p1').textContent=isAvailable;
  console.log(Object.values(parsedResponse));
  var parsedArray = Object.values(parsedResponse);
  var parsedItems = Object.values(parsedArray[7]);
  console.log(parsedItems[0].rate.status);
}

function requestItemInfo(dateForm, paramForm) {//creates a function and passes in the variable 'sku', the function will make a GET request to Checkfront's API
  var endpoint = "https://reidsm100.checkfront.com/api/3.0/item?start_date=" + dateForm + "&end_date=" + dateForm + "&param[participants]=" + paramForm;//concatenates string based on item
	var xhr = new XMLHttpRequest();//creates a new instance of the XMLHttpRequest() called xhr
	xhr.open("GET", endpoint); //(method, url), method can be get, post, put, delete
	xhr.setRequestHeader("Content-Type", "application/json"); //(the name of the header whose value is to be set,the value to set as the body of the header)
	xhr.send();//(body), optional, can be a document or formdata
  xhr.onload = function (data) {//this is the function called when the xhr request completes successfully
    var response = data.currentTarget.response//the response is text but this parses the text into a json object
    return parseResponse(response);
  }
}
</script>